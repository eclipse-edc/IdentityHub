## System tests

System tests run a sample EDC connector with the Identity Hub extension and a DID server using docker. The DID server provides sample DID documents for the EDC connector and an external authority.

The test checks that verifiable credentials can be added to the Identity Hub of the EDC connector using the CLI. In addition, an instance of `CredentialsVerifier` is injected (hence the `@ExtendWith(EdcExtension.class)` annotation) to verify that another EDC connector is able to retrieve and verify the signature of these verifiable credentials.

#### Local test resources

The following test resources are used to run system tests:

- A set of private and public keys for both the external authority and the EDC connector (identity hub owner) at `system-tests/resources/jwt/authority`. These keys were generated with the following commands and are commited into the git repository:

    ```bash
    # generate a private key
    openssl ecparam -name prime256v1 -genkey -noout -out private-key.pem
    # generate corresponding public key
    openssl ec -in private-key.pem -pubout -out public-key.pem
    ```
  
- Web DIDs are available under `system-tests/resources/webdid` folder. The `publicKeyJwk` section of each `did.json` was generated by converting the corresponding public key to JWK format, for example the authority public key was converted to JWK using following command:

    ```bash
    docker run -i danedmunds/pem-to-jwk:1.2.1 --public --pretty < system-tests/tests/resources/jwt/participant/public-key.pem
    ```

## Running tests locally 

Build launcher for system tests

```bash
./gradlew :system-tests:launcher:build
```

Run test components with:

```bash
docker-compose -f system-tests/tests/docker-compose.yml up --build
```

Run test with:

```bash
INTEGRATION_TEST=true ./gradlew :system-tests:tests:test
```